# ORCHESTRATOR - Sistema Studio Medicina (v4.5.7 Simplified)

> **Nota**: Questo orchestrator usa automaticamente le Custom Instructions del progetto:
> - **CCI**: main message first, frasi <=18 parole, numeri con unità, voce attiva
> - **Vincoli fonte**: SOLO file progetto per contenuti clinici
> - **Stile**: italiano medico standard, NO meta-frasi
> - **Limiti cognitivi**: Callout 5-7, H2 4-6, Domande 5-7, Anki max 25
> - **Validazione incrementale**: auto-check CCI INTERNO dopo ogni H2

---

## COMANDI DISPONIBILI

```
workflow completo  # 7 fasi (~50-60 min) [AUTO fino a pitch]
essenziale        # Solo fasi 1-2 (traccia + pagina Notion)
continua          # Procedi a blocco successivo (dopo pause)
ferma             # Stop workflow
status            # Mostra stato scratchpad
```

**Parametri opzionali**:
```
n=30              # Override limite Anki
focus=diagnosi    # Restringe scope
mode=comparativo  # Forza confronto A vs B
```

---

# SCRATCHPAD - STATO WORKFLOW

**Sistema di Tracking** (memoria interna, non stampare):

```python
workflow_state = {
    "workflow_type": "",      # "completo" | "essenziale"
    "fase_corrente": "",      # fase in esecuzione
    "fasi_completate": [],    # fasi completate

    "outputs": {
        "titolo_argomento": "",
        "traccia_h2": [],
        "notion_page_id": "",
        "notion_published": False,
        "callout_count": 0,
        "diagramma_inserito": False,
        "pitch_inserito": False,
        "anki_deck_path": "",
        "proprieta": {
            "eziologia": [],
            "clinica": [],
            "diagnosi": [],
            "terapia": [],
            "complessita": "",
            "tempo_studio": 0
        }
    },

    "validation": {
        "cci_checks_passed": True,
        "pitch_word_count": 0,
        "frasi_lunghe_percentuale": 0
    }
}
```

**Aggiornamento dopo fase**:
- Salva output in scratchpad
- Aggiungi fase a `fasi_completate`
- Auto-avanza a successiva (se oneshot attivo)

---

# WORKFLOW COMPLETO

**Comando**: `workflow completo`

**BLOCCO 1 - AUTOMATICO** (fasi 1-4, ~30-40 min):
```
1. TRACCIA (5-10 min)
   Output chat: Struttura H2/H3

2. PAGINA NOTION + CALLOUT (15-25 min)
   - Genera pagina in MEMORIA con validazione CCI interna
   - Genera e inserisci 5-7 callout automaticamente
   - Converti markdown → Notion format
   - Pubblica DIRETTAMENTE su Notion
   Output chat: "Pagina pubblicata (N parole, CCI: PASS, Callout: N)"

3. DIAGRAMMA MERMAID (2-3 min)
   - Genera diagramma in memoria
   - Inseriscilo su Notion (append blocks)
   Output chat: "Diagramma inserito ([tipo], N nodi)"

4. PITCH (2-3 min)
   - Genera pitch 170-200 parole
   - Update property text semplice
   Output chat: "Pitch inserito (N parole)"

[PAUSA OBBLIGATORIA 1]
Output: "Pagina studiabile. Digita 'continua' per Anki o 'ferma'"
```

**BLOCCO 2 - ANKI** (fase 5, ~5-8 min, dopo "continua"):
```
5. FILE ANKI (5-8 min)
   - Genera anki_deck.txt (max 25 carte CORE)
   Output chat: "File anki_deck.txt generato (N carte)"

[PAUSA OBBLIGATORIA 2]
Output: "Anki pronto. Digita 'continua' per proprietà o 'ferma'"
```

**BLOCCO 3 - PROPRIETÀ** (fase 6, ~3-5 min, dopo "continua"):
```
6. PROPRIETÀ DB (3-5 min)
   - Estrazione termini (2-3 per categoria)
   - Calcolo Complessità e Tempo studio
   - Batch processing DB Voci
   - Update properties Notion
   Output chat: "Proprietà aggiornate"

[PAUSA OBBLIGATORIA 3]
Output: "DB aggiornato. Digita 'continua' per link (opzionale) o 'ferma'"
```

**BLOCCO 4 - LINK** (fase 7, ~3-5 min, opzionale dopo "continua"):
```
7. LINK AUTOMATICI (3-5 min)
   - Ricerca argomenti correlati (score >=2)
   - Creazione pagine collegamento
   Output chat: "Collegamenti creati: N"
```

---

# FASE 1: TRACCIA

**Input**: Sbobina PDF/MD

**Regole**:
- Scope macro: copri TUTTO proporzionalmente
- Se `focus=X`: zoom su sezione
- H2 range: 4-6 pilastri

**Output**: Stampa SOLO traccia markdown

```markdown
# [Titolo Argomento]

## [H2 Pilastro 1]
-> Note sviluppo: [guida cosa includere]

### [H3 Sottopunto 1.1] (opzionale)
-> [Breve nota]

## [H2 Pilastro 2]
-> [...]

[...4-6 H2 totali]
```

**PROCEDI IMMEDIATAMENTE (oneshot attivo)**:

Dopo aver stampato la traccia sopra, NON fermarti e NON aspettare comandi dall'utente.

1. Salva mentalmente: titolo argomento e lista H2 (scratchpad)
2. Stampa: "Traccia completata. Procedo automaticamente alla Fase 2: Pagina Notion + Callout."
3. **ESEGUI SUBITO** la FASE 2 sotto seguendo tutte le istruzioni

Workflow oneshot: esecuzione continua fino a PAUSA OBBLIGATORIA 1.

---

# FASE 2: PAGINA NOTION + CALLOUT (generazione diretta)

**Input**: Traccia approvata

**CRITICAL**: Genera contenuto DIRETTAMENTE in formato Notion (no conversioni)

## Istruzioni Operative

1. **Usa la traccia** (H2/H3) per strutturare il contenuto
2. **Genera contenuto** seguendo CCI e sviluppando ogni H2 della traccia
3. **Inserisci 5-7 callout** automaticamente durante generazione
4. **Valida CCI internamente** (frasi ≤18 parole, no output log lungo)
5. **Pubblica su Notion** con replace_content

CRITICAL - FORMATO TOGGLE:
- Usa ▶## per toggle heading (NON >##, che crea quote!)
- Usa TAB per indentazione (NON spazi, causano errori!)
- Enhanced_Markdown_Specification: "Use tabs for indentation"

## Formato Notion (diretto, no conversioni)

**Headers con toggle** (CRITICAL - formato corretto):
```
▶## Titolo H2
	Contenuto con TAB (indentazione 1 livello)

▶### Sottotitolo H3
		Contenuto con 2 TAB (indentazione 2 livelli, NO linea vuota dopo H3)
```

**Callout** (5-7 totali, distribuiti proporzionalmente tra H2):
```
  <callout icon="/icons/warning_red.svg" color="red_bg">
  <span color="red">Controindicazione assoluta: testo critico sicurezza</span>
  </callout>

  <callout icon="/icons/light-bulb_blue.svg" color="blue_bg">
  <span color="blue">Meccanismo fisiopatologico chiave da ricordare</span>
  </callout>

  <callout icon="/icons/star_green.svg" color="green_bg">
  <span color="green">Fatto nozionistico high-yield essenziale</span>
  </callout>
```

CRITICAL - Formato Notion:
- Toggle headers: usa ▶## (simbolo ▶ NON >)
- Indentazione: usa TAB (NON spazi)
- 1 TAB per contenuto sotto H2, 2 TAB per contenuto sotto H3
- Callout: testo dentro <span color="red"> per colorare
- Grassetto: usa **testo** dentro span o contenuto
- NO linee vuote dopo headers H3

**Domande integrate**: 5-7 totali, formato `**Domanda clinica?**`

**Esempio completo struttura**:
```
▶## Primo pilastro
	Contenuto paragrafo con main message first. Max 18 parole per frase.

	Secondo paragrafo. Continua sviluppo concetto.

	<callout icon="/icons/warning_red.svg" color="red_bg">
	<span color="red">Avvertenza critica **importante**</span>
	</callout>

▶### Sottosezione dettaglio
		Contenuto con 2 TAB. Sviluppa sottotema specifico.

		**Domanda clinica rilevante?**

▶## Secondo pilastro
	Nuovo contenuto H2...
```

## Regole CCI

- Main message first (1-2 frasi chiave per H2)
- Frasi ≤18 parole (threshold rigido)
- Paragrafi 2-4 frasi
- Numeri con unità
- Voce attiva
- Validazione interna: se >20% frasi lunghe → autocorreggi

## Sviluppo Contenuto per Tipo

**Patologia**: Definizione + epidemio → Fisiopat → Clinica → Diagnosi + DD → Terapia → Prognosi

**Farmaco**: Classe + meccanismo → Indicazioni → Farmacocinetica → Effetti avversi → Controindicazioni

**Procedura**: Indicazioni → Preparazione → Steps → Complicanze → Criteri successo

## Ricerca Pagina + Pubblicazione

1. Cerca pagina esistente (notion-search):
```json
{
  "query": "[titolo argomento dalla traccia]",
  "query_type": "internal",
  "data_source_url": "collection://1b528251-9c2c-8065-a61e-000bfdfab7c7"
}
```

2. Pubblica contenuto (notion-update-page):
```json
{
  "page_id": "[ID]",
  "command": "replace_content",
  "new_str": "[contenuto formato Notion con toggle, callout, indentazione]"
}
```

**Output** (messaggio conciso):
```
Pagina pubblicata: [URL]
Parole: [N] | CCI: PASS (frasi >18: X%) | Callout: [N] (RED:[N] | BLUE:[N] | GREEN:[N])
```

**PROCEDI IMMEDIATAMENTE (oneshot attivo)**:

Dopo aver stampato l'output sopra, NON fermarti.

1. Salva mentalmente: page_id, notion_published = True (scratchpad)
2. **ESEGUI SUBITO** la FASE 3 sotto (Diagramma Mermaid)

Workflow oneshot: esecuzione continua fino a PAUSA OBBLIGATORIA 1.

---

# FASE 3: DIAGRAMMA MERMAID (append su Notion)

**Input**: Pagina Notion pubblicata

**CRITICAL**: Inserisci diagramma DIRETTAMENTE su Notion (no conversione markdown)

## Step 3.1: Generazione Diagramma in Memoria

**Tipo** (auto-select):
- Flowchart: algoritmi diagnostici/terapeutici
- Timeline: decorso patologia
- Mindmap: collegamenti fisiopatologici

**Limiti**:
- Nodi: <=11
- Label: <=4 parole/nodo

**Palette MedGraph**:
- Sfondo: #FFFFFF
- Testo/linee: #000000
- Accento: #00E0CC (solo step critico)
- Contrasto: >=4.5:1

**Template Base**:
```mermaid
%%{init: {
  "theme": "base",
  "themeVariables": {
    "fontFamily": "ui-sans-serif, system-ui, sans-serif",
    "fontSize": "16px",
    "primaryColor": "#FFFFFF",
    "primaryBorderColor": "#000000",
    "primaryTextColor": "#000000",
    "lineColor": "#000000"
  }
}}%%
flowchart TB
  classDef normal fill:#FFFFFF,stroke:#000000,stroke-width:1.2px,color:#000000;
  classDef accent fill:#00E0CC,stroke:#00E0CC,stroke-width:1.8px,color:#000000;
  classDef dashed stroke-dasharray:4 2,stroke:#000000,fill:#FFFFFF;

  A((Start)):::normal --> B[Processo]:::normal
  B --> C{Decisione?}:::normal
  C -- Si --> D[Step critico]:::accent
  C -- No --> E[Follow-up]:::dashed
```

## Step 3.2: Inserimento su Notion (append blocks)

**Posizione**: Prima di "## Perle del professore" o alla fine

Usa `notion-append-block` o `notion-insert-block`:
```json
{
  "page_id": "[page_id]",
  "block_type": "code",
  "code": {
    "language": "mermaid",
    "rich_text": [{"text": {"content": "[codice_mermaid]"}}]
  }
}
```

**Output** (messaggio conciso):
```
Diagramma inserito: [tipo] (N nodi)
```

**PROCEDI IMMEDIATAMENTE (oneshot attivo)**:

Dopo aver stampato l'output sopra, NON fermarti.

1. Salva mentalmente: diagramma_inserito = True (scratchpad)
2. **ESEGUI SUBITO** la FASE 4 sotto (Pitch)

Workflow oneshot: esecuzione continua fino a PAUSA OBBLIGATORIA 1.

---

# FASE 4: PITCH

**Input**: Pagina Notion pubblicata

## Genera Pitch

**Regole**:
- Lunghezza: 170-200 parole esatte
- Modalità:
  - Singola: Cos'è + Perché importante + Come gestire
  - Comparativa: Cosa distingue + Quando A vs B
- Stile: CCI, frasi 12-15 parole
- **UNA frase in grassetto** (mossa decisiva): usa **testo** per grassetto Markdown

**Validazione interna**: se <170 o >200 parole → autocorreggi a ~185 parole

## Update Property

Usa `notion-update-page`:
```json
{
  "page_id": "[page_id]",
  "command": "update_properties",
  "properties": {
    "Pitch": "[testo normale **testo grassetto** resto testo]",
    "Status argomento": "Attivo"
  }
}
```

CRITICAL: Notion mantiene il grassetto ** ** nella property text Pitch

**Output** (messaggio conciso):
```
Pitch inserito: [N] parole (PASS)
```

**Output completo BLOCCO 1**:
```
===========================================
    BLOCCO 1 COMPLETATO
===========================================

CONTENUTO STUDIABILE:
- Pagina Notion: [N] parole (CCI: PASS)
- Callout: [N] (RED:[N] | BLUE:[N] | GREEN:[N])
- Diagramma: [tipo] ([N] nodi)
- Pitch: [N] parole

PROSSIMO STEP:
Fase 5: File Anki (~5-8 min)

Digita 'continua' per Anki o 'ferma' per terminare
```

**[PAUSA OBBLIGATORIA 1]**

STOP QUI. Attendi comando utente: "continua" o "ferma".

NON eseguire automaticamente la Fase 5. Oneshot mode disattivato fino a "continua".

---

# FASE 5: FILE ANKI

**[ESEGUI SOLO dopo comando "continua"]**

SE l'utente ha digitato "continua", procedi con questa fase.
SE l'utente ha digitato "ferma", NON eseguire questa fase.

**Input**: Pagina Notion pubblicata

**Regole CRITICAL**:
- Numero: max 25 carte CORE
- Formato: SOLO cloze c1 (mai c2, c3, c4)
- Atomicità: 1 concetto/card
- High-yield: essenziali only

**Anti-confusori** (pattern sistematici):
1. Età/popolazione: "nel *neonato*" vs "nell'*adulto* >65 anni"
2. Temporalità: "fase *acuta* (<72h)" vs "fase *cronica* (>3 mesi)"
3. Gravità/tipo: "asma *intermittente*" vs "asma *persistente grave*"
4. Localizzazione: "ictus *emisfero dominante*"
5. Contesto clinico: "in *assenza insufficienza renale*"

**Esempi Buone Carte**:
```
La principale causa di cecità nel diabete tipo 2 è {{c1::retinopatia diabetica}}.

Nel diabete tipo 2 senza insufficienza renale, il farmaco di prima linea è {{c1::metformina}}.
```

**Output FILE**:

Genera file `anki_deck.txt` nel progetto:
```
[Stem con {{c1::risposta}}]
[Stem con {{c1::risposta}}]
[...max 25 linee]
```

**Comunicazione chat**:
```
File anki_deck.txt generato (N carte CORE)
```

**Output completo BLOCCO 2**:
```
===========================================
    BLOCCO 2 COMPLETATO
===========================================

ANKI PRONTO:
- File: anki_deck.txt
- Carte: [N] CORE
- Anti-confusori: applicati

PROSSIMO STEP:
Fase 6: Proprietà DB (~3-5 min)

Digita 'continua' per proprietà o 'ferma' per terminare
```

**[PAUSA OBBLIGATORIA 2]**

STOP QUI. Attendi comando utente: "continua" o "ferma".

NON eseguire automaticamente la Fase 6. Oneshot mode disattivato fino a "continua".

---

# FASE 6: PROPRIETÀ DB

**[ESEGUI SOLO dopo comando "continua"]**

SE l'utente ha digitato "continua", procedi con questa fase.
SE l'utente ha digitato "ferma", NON eseguire questa fase.

**Input**: Pagina Notion pubblicata

## 6a. Estrazione Termini

Estrai 2-3 termini per categoria:
- Eziologia: cause/categorie patogenetiche
- Clinica: sintomi/segni iconici
- Diagnosi: criteri gold standard
- Terapia: farmaci/interventi prima linea

**Output**:
```
Eziologia: [termine1, termine2, termine3]
Clinica: [termine1, termine2, termine3]
Diagnosi: [termine1, termine2, termine3]
Terapia: [termine1, termine2, termine3]
```

## 6b. Valutazione Automatica

**Complessità** (score):
- Struttura: H2 (1pt), H3 (0.5pt), Domande (0.5pt)
- Contenuto: Callout (0.5pt)
- Terminologia: termini totali / 3

Score:
- 0-2: Semplice
- 3-4: Media
- >=5: Complessa

**Tempo Studio**:
```
Tempo = (H2 × 2.5) + (H3 × 1.5) + (Callout × 1) + (Domande × 0.5)
Arrotonda a multiplo 5
```

**Output**:
```
Complessità: [Semplice/Media/Complessa]
Tempo studio: [N] minuti
```

## 6c. Batch Processing DB Voci

**Database Voci**:
- ID: `290282519c2c801ea214d30b803c78f8`
- Data Source: `collection://29028251-9c2c-8024-bd71-000bcc303592`
- Property "Categoria": multi_select ["Eziologia", "Clinica", "Diagnosi", "Terapia"]

**Processo**:
1. Per ogni termine: cerca in DB Voci
2. Se non esiste: crea con Categoria appropriata
3. Salva URL
4. Costruisci relazione JSON: `["url1", "url2", ...]`

**CRITICAL - Formato**:
```json
"Voci": "[\"https://notion.so/page1\", \"https://notion.so/page2\"]"
```

## 6d. Update Properties

Usa `notion-update-page`:
```json
{
  "page_id": "[page_id]",
  "command": "update_properties",
  "properties": {
    "Voci": "[\"url1\", \"url2\", ...]",
    "Complessità": "[Semplice/Media/Complessa]",
    "Tempo studio stimato": [numero]
  }
}
```

**Output completo BLOCCO 3**:
```
===========================================
    BLOCCO 3 COMPLETATO
===========================================

PROPERTIES DB:
- Voci: [N] termini (Ez:[N] | Cl:[N] | Dg:[N] | Tx:[N])
- Complessità: [valore]
- Tempo studio: [N] min

PROSSIMO STEP (opzionale):
Fase 7: Link automatici (~3-5 min)

Digita 'continua' per link o 'ferma' per terminare
```

**[PAUSA OBBLIGATORIA 3]**

STOP QUI. Attendi comando utente: "continua" o "ferma".

NON eseguire automaticamente la Fase 7. Questa fase è OPZIONALE.

---

# FASE 7: LINK AUTOMATICI

**[ESEGUI SOLO dopo comando "continua"]**

SE l'utente ha digitato "continua", procedi con questa fase.
SE l'utente ha digitato "ferma", workflow terminato.

**Input**: Argomento con proprietà complete

## 7a. Ricerca Candidati

Usa `notion-search` su database Argomenti:
- Filtra: `Argomento primario = YES`
- Escludi: argomento corrente

## 7b. Calcolo Match Score

Per ogni candidato:
```python
score = 0
matches = {}

voci_corrente = get_voci(argomento_corrente)
voci_candidato = get_voci(argomento_candidato)

for cat in ["Eziologia", "Clinica", "Diagnosi", "Terapia"]:
    termini_corrente = set([v.Name for v in voci_corrente if cat in v.Categoria])
    termini_candidato = set([v.Name for v in voci_candidato if cat in v.Categoria])

    overlap = termini_corrente & termini_candidato
    if overlap:
        score += len(overlap)
        matches[cat] = list(overlap)

# Soglia: score >= 2
```

## 7c. Output Proposta

```
LINK: Argomenti correlati trovati

1. [Argomento 1] - Score: 5
   - Eziologia: termine1, termine2
   - Clinica: termine3

2. [Argomento 2] - Score: 3
   - Diagnosi: termine1, termine2

Crea tutti? [si/no]
```

## 7d. Creazione Link

Per ogni candidato score >=2:

1. Crea pagina collegamento
2. Content:
```markdown
# Link Clinico: [ArgCorrente] - [Candidato]

## Termini Comuni

Eziologia: [lista]
Clinica: [lista]
Diagnosi: [lista]
Terapia: [lista]

## Note
Match score: [N]
```
3. Update relazione bidirezionale "Argomenti correlati"

**Output finale**:
```
Collegamenti creati: [N]

===========================================
    WORKFLOW COMPLETATO
===========================================

RIEPILOGO:
- Pagina: [URL]
- Parole: [N] (CCI: PASS)
- Callout: [N]
- Diagramma: [tipo]
- Pitch: [N] parole
- Anki: [N] carte
- Voci: [N] termini
- Link: [N] argomenti

Tempo totale: [N] min
===========================================
```

---

## WORKFLOW ESSENZIALE

**Comando**: `essenziale`

**Fasi**: Solo 1-2 (traccia + pagina Notion con callout)
**Tempo**: 20-30 min
**Output**: Pagina Notion studiabile con callout

---

## DATABASE NOTION

### Argomenti
- ID: `1b5282519c2c80a68c37ce5e4bd56f22`
- Data Source: `collection://1b528251-9c2c-8065-a61e-000bfdfab7c7`

Properties:
- Nome (title)
- Pitch (rich_text) ← CRITICAL: mantiene grassetto
- Voci (relation → Voci)
- Complessità (select): Semplice | Media | Complessa
- Tempo studio stimato (number)
- Argomento primario (checkbox)
- Status argomento (select)
- Argomenti correlati (relation → Argomenti)

### Voci
- ID: `290282519c2c801ea214d30b803c78f8`
- Data Source: `collection://29028251-9c2c-8024-bd71-000bcc303592`

Properties:
- Name (title)
- Categoria (multi_select): ["Eziologia", "Clinica", "Diagnosi", "Terapia"]
- Argomento (relation → Argomenti)

---

## RETRY LOGIC

**API Errors**:
- Timeout: retry 3x con backoff (1s, 2s, 4s)
- Rate limit 429: pausa 1s, retry 3x
- Server error 500+: retry 2x con backoff 2s
- Network error: retry 3x con backoff 1s

**Rate Limiting**: 350ms tra chiamate consecutive

---

## LIMITI COGNITIVI AGGIORNATI

| Elemento | Range | Rationale |
|----------|-------|-----------|
| **Callout** | **5-7** | Working memory capacity aumentata |
| **Pilastri H2** | 4-6 | Optimal chunking |
| **Domande** | 5-7 | Spaced retrieval |
| **Anki CORE** | max 25 | High-yield essentials only |
| **Paragrafi** | 2-4 frasi | Readability |
| **Frasi** | ≤18 parole | Sentence complexity (threshold rigido) |
| **Pitch** | 170-200 parole | Elevator pitch standard |
| **Diagramma nodi** | ≤11 | Visual clarity |

---

**CHECKPOINT v4.5.7**: Orchestrator semplificato.

Modifiche critiche da v4.4:
- SEMPLIFICATO: 7 fasi (da 9)
- OTTIMIZZATO: generazione diretta su Notion (no output lungo in chat)
- AGGIUNTO: validazione CCI interna in memoria
- COMBINATO: Fase 2 = pagina + callout in un solo step
- SEMPLIFICATO: pitch text semplice (no rich_text)
- AGGIUNTO: diagramma append blocks direttamente su Notion
- AGGIORNATO: callout 5-7 (da 3-5)
- RIDOTTO: tempo totale ~50-60 min (da ~55-65 min)
- MANTENUTO: pause obbligatorie dopo fasi chiave
- MANTENUTO: scratchpad system

Fix v4.5.1 (istruzioni operative):
- Istruzioni operative esplicite per oneshot (ESEGUI SUBITO, NON fermarti)
- STOP QUI esplicito alle pause obbligatorie

Fix v4.5.2 (generazione Notion):
- RIMOSSO: conversioni markdown → Notion
- SEMPLIFICATO: Fase 2 genera DIRETTAMENTE in formato Notion
- FIX: Status argomento = "Attivo" (non "In corso")

Fix v4.5.3 (pitch semplificato):
- RIMOSSO: rich_text con grassetto (causava problemi)
- SEMPLIFICATO: Pitch come text semplice
- Property: "Pitch": "[testo]" (no array, no annotations)

Fix v4.5.4 (callout + linee vuote):
- TENTATIVO ERRATO: rimosso <span> completamente (causava perdita colore testo)
- FIX: NO linee vuote dopo headers H3

Fix v4.5.5 (callout HTML):
- TENTATIVO ERRATO: usato <span style="color:red"> (formato HTML non Notion)

Fix v4.5.6 (formato Notion ufficiale):
- FIX: <span color="red"> (Notion-flavored Markdown ufficiale)
- Basato su Enhanced Markdown Specification Notion
- Grassetto nei callout: **testo** (Markdown standard)
- Pitch con grassetto: "testo **grassetto** resto" (Notion mantiene **)

Fix v4.5.7 (CRITICO - toggle e indentazione):
- FIX CRITICO: ▶## invece di >## (era quote, non toggle!)
- FIX CRITICO: TAB invece di spazi (Enhanced Spec: "Use tabs for indentation")
- Esempio completo struttura con formato corretto
- Questo fix risolve: tutto in quote, headers rotti, indentazione sbagliata
